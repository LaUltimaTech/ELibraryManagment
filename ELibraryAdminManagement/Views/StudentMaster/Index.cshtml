@{
    ViewData["Title"] = "Student Master";
    
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
    body {
        padding-top: 70px; /* leave space for fixed navbar */
        background: linear-gradient(to bottom right, #f8f9fa, #ffffff);
        min-height: 100vh;
    }

    .navbar-text {
        font-weight: bold;
    }

    .orange-bar {
        background: linear-gradient(90deg, #ff7f11, #ff9f1c);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .card {
        background-color: #fff;
        box-shadow: 0 0 12px rgba(0,0,0,0.1);
        border: none;
        border-radius: 12px;
    }

    .form-label {
        font-weight: 600;
        color: #080808;
        font-size: 0.9rem;
    }

    .form-control {
        height: 32px !important;
        padding: 4px 8px !important;
        font-size: 0.9rem !important;
        border-radius: 6px !important;
    }

    .btn-custom {
        border: none;
        color: white !important;
        padding: 6px 20px;
        border-radius: 6px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        margin: 0 5px;
        font-weight: 500;
    }

    table {
        margin-top: 25px;
        font-size: 0.95rem;
    }

    th {
        background-color: #007bff;
        color: white;
        text-align: center;
    }

    td {
        vertical-align: middle;
        text-align: center; /* centers all content in table cells */
    }

        /* ================= BUTTON FIX ================= */
        td button {
            margin: 0 2px; /* space between buttons */
            min-width: 60px; /* consistent button width */
            font-size: 0.8rem;
            padding: 3px 6px;
        }
</style>


<!-- ================= ORANGE NAVBAR ================= -->
<nav class="navbar orange-bar fixed-top py-2">
    <div class="container justify-content-center">
        <span class="navbar-text h5 text-white mb-0">Student Master</span>
    </div>
</nav>

<div class="container mt-4">

    <h4 class="text-primary mb-3">Student Master - Single Page</h4>

    <!-- ================= FORM ================= -->
    <form id="studentForm" class="border p-3 rounded bg-light">

        <input type="hidden" name="StudentId" id="StudentId" />

        <div class="row">

            <div class="col-md-4 mb-2">
                <label>Student Name</label>
                <input class="form-control" name="StudentName" id="StudentName" required />
            </div>

            <div class="col-md-4 mb-2">
                <label>Admission No</label>
                <input class="form-control" name="AdmissionNo" id="AdmissionNo" required />
            </div>

            <div class="col-md-4 mb-2">
                <label>Date of Birth</label>
                <input type="date" class="form-control" name="DateOfBirth" id="DateOfBirth" />
            </div>

            <div class="col-md-4 mb-2">
                <label>Email</label>
                <input class="form-control" name="EmailId" id="EmailId" />
            </div>

            <div class="col-md-4 mb-2">
                <label>School</label>
                <select class="form-control" name="SchoolId" id="SchoolId" required>
                    <option value="">-- Select --</option>
                    @foreach (var s in ViewBag.Schools)
                    {
                        <option value="@s.Id">@s.SchoolName</option>
                    }
                </select>
            </div>

            <div class="col-md-4 mb-2">
                <label>Standard</label>
                <select class="form-control" name="StandardId" id="StandardId" required>
                    <option value="">-- Select --</option>
                    @foreach (var s in ViewBag.Standards)
                    {
                        <option value="@s.Id">@s.StandardName</option>
                    }
                </select>
            </div>

            <div class="col-md-4 mb-2">
                <label>Division</label>
                <select class="form-control" name="DivisionId" id="DivisionId" required>
                    <option value="">-- Select --</option>
                    @foreach (var s in ViewBag.Divisions)
                    {
                        <option value="@s.Id">@s.DivisionName</option>
                    }
                </select>
            </div>

            <div class="col-md-12 mb-2">
                <label>Address</label>
                <textarea class="form-control" name="Address" id="Address"></textarea>
            </div>

            <div class="col-md-3 mb-2">
                <label>City</label>
                <input class="form-control" name="City" id="City" />
            </div>

            <div class="col-md-3 mb-2">
                <label>District</label>
                <input class="form-control" name="District" id="District" />
            </div>

            <div class="col-md-3 mb-2">
                <label>State</label>
                <input class="form-control" name="State" id="State" />
            </div>

            <div class="col-md-4 mb-2">
                <label>Father Name</label>
                <input class="form-control" name="FatherName" id="FatherName" />
            </div>

            <div class="col-md-4 mb-2">
                <label>Father Mobile</label>
                <input class="form-control" name="FatherMobileNumber" id="FatherMobileNumber" />
            </div>

            <div class="col-md-4 mb-2">
                <label>Father Whatsapp</label>
                <input class="form-control" name="FatherWhatsappNumber" id="FatherWhatsappNumber" />
            </div>

            <div class="col-md-4 mb-2">
                <label>Mother Name</label>
                <input class="form-control" name="MotherName" id="MotherName" />
            </div>

            <div class="col-md-4 mb-2">
                <label>Mother Mobile</label>
                <input class="form-control" name="MotherMobileNumber" id="MotherMobileNumber" />
            </div>

            <div class="col-md-4 mb-2">
                <label>Mother Whatsapp</label>
                <input class="form-control" name="MotherWhatsappNumber" id="MotherWhatsappNumber" />
            </div>
        </div>

        <button class="btn btn-success mt-2" type="submit">Save</button>
        <button class="btn btn-secondary mt-2" type="button" onclick="resetForm()">Reset</button>

    </form>

    <!-- ================= TABLE ================= -->
    <hr />

    <table class="table table-bordered" id="studentTable">
        <thead class="table-dark">
            <tr>
                <th>Sr.No</th>
                <th>Name</th>
                <th>Adm No</th>
                <th>School</th>
                <th>Std</th>
                <th>Div</th>
                <th>Mobile</th>
                <th style="width:90px;">Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // ================= LOAD DATA =================
    function loadData() {
        $.get("/StudentMaster/GetList", function (res) {
            let rows = "";
            let i = 1;
            res.data.forEach(s => {
                rows += `
                            <tr>
                                <td>${i++}</td>
                                <td>${s.studentName}</td>
                                <td>${s.admissionNo}</td>
                                <td>${s.school.schoolName}</td>
                                <td>${s.standard.standardName}</td>
                                <td>${s.division.divisionName}</td>
                                <td>${s.fatherMobileNumber}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="editRecord(${s.studentId})">Edit</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteRecord(${s.studentId})">Del</button>
                                </td>
                            </tr>`;
            });
            $("#studentTable tbody").html(rows);
        });
    }

    // ================= SAVE =================
    $("#studentForm").submit(function (e) {
        e.preventDefault();
        $.post("/StudentMaster/Save", $(this).serialize(), function () {
            loadData();
            resetForm();
        });
    });

    // ================= EDIT =================
    // function editRecord(id) {
    //     $.get("/StudentMaster/Edit/" + id, function (data) {
    //         for (let key in data) {
    //             $("#" + key).val(data[key]);
    //         }
    //     });
    // }

    function editRecord(id) {
        $.get("/StudentMaster/Edit/" + id, function (data) {

            // Direct fields
            $("#StudentId").val(data.studentId);
            $("#StudentName").val(data.studentName);
            $("#AdmissionNo").val(data.admissionNo);
            $("#DateOfBirth").val(data.dateOfBirth ? data.dateOfBirth.split("T")[0] : "");
            $("#EmailId").val(data.emailId);
            $("#Address").val(data.address);
            $("#City").val(data.city);
            $("#District").val(data.district);
            $("#State").val(data.state);
            $("#FatherName").val(data.fatherName);
            $("#FatherMobileNumber").val(data.fatherMobileNumber);
            $("#FatherWhatsappNumber").val(data.fatherWhatsappNumber);
            $("#MotherName").val(data.motherName);
            $("#MotherMobileNumber").val(data.motherMobileNumber);
            $("#MotherWhatsappNumber").val(data.motherWhatsappNumber);

            // Dropdowns
            $("#SchoolId").val(data.schoolId);
            $("#StandardId").val(data.standardId);
            $("#DivisionId").val(data.divisionId);

            // Scroll to top for better UX
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }


    // ================= DELETE =================
    function deleteRecord(id) {
        if (!confirm("Are you sure?")) return;
        $.post("/StudentMaster/Delete/" + id, function () {
            loadData();
        });
    }

    // ================= RESET =================
    function resetForm() {
        $("#studentForm")[0].reset();
        $("#StudentId").val("");
    }

    // FIRST LOAD
    loadData();
</script>
